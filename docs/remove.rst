==========
piw-remove
==========

The piw-remove script is used to manually remove a version of a package from
the system. All builds for the specified version will be forgotten, all files
generated by such builds will be deleted, and all logged downloads will be
deleted too.

By default, the version removed will *not* be marked to skip. Hence, after a
short while the master is likely to attempt to re-build it. What happens at
this point depends on several factors:

* If the version is still available on PyPI, and the build dependencies on the
  chosen slave are sufficient, it will (potentially) build successfully and
  re-appear on the system.

* If the version has been removed from PyPI (which is a reason to remove it
  from piwheels), the build will fail. The failed build will be logged in the
  system and will not be attempted again.

Synopsis
========

.. code-block:: text

    piw-remove [-h] [--version] [-c FILE] [-q] [-v] [-l FILE] [-y]
               [-s REASON] [--import-queue ADDR]
               package version


Description
===========

.. program:: piw-remove

.. option:: package

    The name of the package to remove

.. option:: version

    The version of the package to remove

.. option:: -h, --help

    Show this help message and exit

.. option:: --version

    Show program's version number and exit

.. option:: -c FILE, --configuration FILE

    Specify a configuration file to load

.. option:: -q, --quiet

    Produce less console output

.. option:: -v, --verbose

    Produce more console output

.. option:: -l FILE, --log-file FILE

    Log messages to the specified file

.. option:: -y, --yes

    Run non-interactively; never prompt during operation

.. option:: -s REASON, --skip REASON

    Mark the version with a reason to prevent future build attempts

.. option:: --import-queue ADDR

    The address of the queue used by piw-remove (default:
    (ipc:///tmp/piw-import); this should always be an ipc address


Usage
=====

This utility is typically used in response to a request from a package
maintainer to remove a specific build from the system. Either because it has
been withdrawn from PyPI itself, or because the presence of a piwheels build is
causing issues in and of itself (both circumstances have occurred).

The utility can be run in a batch mode with :option:`--yes` but still requires
invoking once per deletion required (you cannot remove multiple versions in a
single invocation).

The return code will be 0 if the version was successfully removed. If anything
fails, the return code will be non-zero and no files should be deleted (but
this cannot be guaranteed in all circumstances).

The utility should only ever be run directly on the master node (opening the
import queue to other machines is a potential security risk).
